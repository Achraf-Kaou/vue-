<template>
  <section class="p-4 w-full">
    <div class="bg-white rounded-lg shadow-md p-6">
      <div class="mb-6 flex items-center">
        <Search class="w-5 h-5 mr-2 text-gray-700" />
        <span class="font-bold text-lg">DOMAIN MALWARE CHECK</span>
      </div>

      <div v-if="Object.keys(props.data.domains).length > 0" class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-b"
              >
                DOMAIN
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-b"
              >
                STATUS
              </th>
              <th
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-b"
              >
                GEOLOCATION
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr
              v-for="(details, domain) in props.data.domains"
              :key="domain"
              class="hover:bg-gray-50"
            >
              <td class="px-4 py-3 text-sm text-gray-900 border-b">
                {{ domain }}
              </td>
              <td class="px-4 py-3 text-sm border-b">
                <div v-if="details.bad === 'yes'">
                  <span
                    class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800"
                  >
                    <AlertCircle class="w-3 h-3 mr-1" />
                    malware
                  </span>
                  <div class="mt-2 text-xs bg-gray-50 p-2 rounded border border-gray-200">
                    <div><strong>URL: </strong>{{ details.domain_or_url }}</div>
                    <div>
                      <strong>IP: </strong>
                      <span
                        class="inline-flex items-center rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800"
                      >
                        {{ details.ip }}
                      </span>
                    </div>
                    <div><strong>Description: </strong>{{ details.desc }}</div>
                  </div>
                </div>
                <div v-else>
                  <span
                    class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800"
                  >
                    <Shield class="w-3 h-3 mr-1" />
                    ok
                  </span>
                </div>
              </td>
              <td class="px-4 py-3 text-xs border-b">
                <div v-if="details.geolocation" class="space-y-1">
                  <div><strong>IP: </strong>{{ details.geolocation.ip }}</div>
                  <div><strong>Country: </strong>{{ details.geolocation.country_long }}</div>
                  <div><strong>Region: </strong>{{ details.geolocation.region }}</div>
                  <div><strong>City: </strong>{{ details.geolocation.city }}</div>
                  <div><strong>Latitude: </strong>{{ details.geolocation.latitude }}</div>
                  <div><strong>Longitude: </strong>{{ details.geolocation.longitude }}</div>
                  <div>
                    <strong>View: </strong>
                    <a
                      :href="`http://maps.google.com/maps?q=${details.geolocation.latitude},${details.geolocation.longitude}`"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-blue-600 hover:underline"
                    >
                      Google Map
                    </a>
                  </div>
                </div>
                <span v-else class="text-gray-500">No Geolocation information available.</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div v-else class="py-4 text-center text-gray-500">No domain check data available.</div>
    </div>
  </section>
</template>

<script setup lang="ts">
import { Search, Shield, AlertCircle } from 'lucide-vue-next'

const props = defineProps<{
  data: {
    domains: {
      [key: string]: {
        bad: string
        domain_or_url?: string
        ip?: string
        desc?: string
        geolocation: {
          ip: string
          country_long: string
          country_short?: string
          region: string
          city: string
          latitude: string
          longitude: string
        } | null
        ofac: boolean
      }
    }
  }
}>()
</script>
